---
title: "Untitled"
output: html_document
date: "2024-04-16"
---


```{r}
library(stats)
library(PowerTOST)
library(TrialSize)
```

```{r}
#install.packages("TrialSize")
```



Задача1.  Рассчитайте выборку для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна. Из предыдущих исследований известно, что дисперсия составляет 20% ( = 0.20), а разница средних составляет −10% (ɛ = ɱ test  -  ɱreferense), что клинически значимая разница составляет 25% (σ= 0.25).

Двухпериодный cross-over дизайн клинического исследования - это методика, которая используется для сравнения двух или более препаратов(схем лечения/лечебных режимов). Основная идея кроссовер-дизайна заключается в том, чтобы уменьшить влияние переменных между участниками исследования, таких как возраст, пол, генетические факторы и т. д. Путем применения нескольких лечебных режимов каждый участник служит самому себе контролем, что позволяет уменьшить влияние внешних факторов и повысить точность результатов.
Эквивалентность (equivalence) это концепция, используемая в биостатистике и клинических исследованиях для оценки,когда новое лечение/препарат считается эквивалентным стандартному лечению/или препарату, т.е. они демонстрируют сравнимую эффективность без статистически значимых различий.

```{r}
σ = 0.25  # клинически значимая разница

σ_m = 0.20  # дисперсия
ϵ = - 0.1   # ɛ = ɱ test  -  ɱ referense разница средних  

alpha <- 0.05     # уровень значимости (например, 0.05 для 5%)
beta <- 0.20      # уровень мощности (например, 0.20 для 80%)

# критические значения Z для выбранного уровня значимости и мощности
Z_alpha_2 <- qnorm(1 - alpha/2)
Z_beta <- qnorm(1 - beta)

# доля участников, которые выбывают из исследования,
dropout_rate <- 0.1  # Пример: dropout rate 10%

# расчет размера выборки
#n <- (Z_alpha_2 + Z_beta)^2 * σ_m^2 / (2 * (σ - abs(ϵ))^2)
n <- ((Z_alpha_2 + Z_beta)^2 * σ_m^2 / (2 * (σ - abs(ϵ))^2))/(1 - dropout_rate)


print(paste("Размер выборки:", ceiling(n)))
```
Для данного исследования требуется, как минимум, 8 участников в каждой из двух групп для обнаружения клинически значимой разницы между тестовым и контрольным препаратами при уровне значимости 0.05 и мощности теста 0.8.
Всего нужно чтобы n=16.

Нулевая гипотеза (H0): эффект тестового препарата не хуже (не превосходит) эффекта контрольного препарата на клинически значимую величину ϵ (μ test − μ reference ≥− ϵ).

Альтернативная гипотеза (H1): Эффект тестового препарата хуже (превосходит) эффект контрольного препарата на клинически значимую величину ϵ (μ test − μ reference <− ϵ).




Задача 2. Рассчитайте выборку для гипотезы non-inferiority для двухвыборочного параллельного дизайна. Пусть клинически значимая разница σ = -0.1, то есть мы ожидаем разницу не меньше 10%, а долю ответов для тестового препарата p2 = 0.65, в то время как нам известно из предыдущих исследований, что доля ответов у препарата сравнения составляет p1 = 0.85. Соотношение групп равно k = 1.

"Non-inferiority" (неинфериорность) - это концепция, используемая в биостатистике и клинических исследованиях для оценки, сравнивают ли новое лечение или метод с уже существующим стандартным лечением или методом. Цель таких исследований - доказать, что новое лечение не хуже стандартного, с учетом заранее определенного предела "некритической разницы" (non-inferiority margin).
```{r}

# параметры
p1 <- 0.85  # доля ответов для препарата 1
p2 <- 0.65  # доля ответов для препарата 2
σ <- -0.1  # клинически значимая разница
alpha <- 0.05  # уровень значимости
beta <- 0.2  # уровень мощность

# находим критические значения Z
Z_alpha_over_2 <- qnorm(1 - alpha/2)
Z_beta <- qnorm(1 - beta)

# рассчитываем размер выборки
n <- (((Z_alpha_over_2 + Z_beta)^2 * (p1 * (1 - p1) + p2 * (1 - p2))) / ((p1 - p2 - σ)^2))/(1 - dropout_rate)

# округляем результат до целого числа
n2 <- ceiling(n)

print(n2)
```

  Вывод: необходимо иметь по крайней мере 35 участника в каждой группе, для того, чтобы обнаружить клинически значимую разницу с уровнем значимости 0.05 и мощностью теста 0.8 при предполагаемых долях ответов для препаратов и клинически  значимой разнице между ними.
  
  Нулевая гипотеза (H0): редний эффект нового препарата не хуже эффекта стандартного препарата на клинически значимую величину σ (то есть μ1−μ2≥−σ).

Альтернативная гипотеза (H1): Средний эффект нового препарата хуже эффекта стандартного препарата на клинически значимую величину σ (то есть μ1−μ2<−σ).
  
  
  
  
  
Задача 4. Рассчитайте выборку для гипотезы equality для следующего исследования. Мы хотим сравнить новую терапию инфекции, присоединяющейся в больничных условиях у пациентов с ожогами, с золотым стандартом, основываясь на данных, анализируемых с помощью регрессии Кокса. Пусть отношение рисков «золотой стандарт / новая терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов ( d = 0.8) могут столкнуться с этим заболеванием. Соотношения групп терапии равны (p1 = p2 = 0.5). 

  
  
  
```{r}
# Отношение рисков
HR <- 2
# Процент пациентов d
d <- 0.8
# Соотношение групп
p1 <- 0.5
p2 <- 0.5
alpha <- 0.05  # уровень значимости
beta <- 0.2  # уровень мощность

# находим критические значения Z
Z_alpha_over_2 <- qnorm(1 - alpha/2)
Z_beta <- qnorm(1 - beta)

# доля участников, которые выбывают из исследования,
dropout_rate <- 0.1  # Пример: dropout rate 10%

# Рассчитываем выборку для исследования
n <- (((Z_alpha_over_2 + Z_beta)^2) / (log(HR)^2 * (p1 * p2 * d))) / (1 - dropout_rate)

# Округляем вверх до ближайшего целого числа
n <- ceiling(n)

print(n)

```
Вывод: для данного исследования необходимо включить в выборку 91 участника в одной группе, и 182 участника для всего исследования, при уровне значимости 0.05 и мощности теста 0.8
  
  
  
  
  
  


